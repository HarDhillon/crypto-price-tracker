<!-- Script on client side that wait for socket emit, and then updates newest prices and works out newest % difference -->

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    socket.on('coinDataUpdated', (updatedCoinData) => {
 

        // Find overarching coin data div
        const coinDataElements = document.querySelectorAll('.coin-data');

        coinDataElements.forEach((element, index) => {

            // Update 
            const coinNameElement = element.querySelector('.coin-name');
            const coinPriceElement = element.querySelector('.coin-price');
            
            coinNameElement.textContent = updatedCoinData[index].name;
            coinPriceElement.textContent = updatedCoinData[index].price

            const currentPrice = parseFloat(element.querySelector('.coin-price').innerText)
            const buyPriceElement = element.querySelector('.buy-price')
            const profitLossElement = element.querySelector('.profit-loss-number')

            // If user has bought coin input field will be gone and buy price will be present
            if(buyPriceElement){
                const buyPrice = parseFloat(buyPriceElement.innerText)

                // Work out the % difference from when user bought to current
                const percentDifference = ((currentPrice - buyPrice) / buyPrice) * 100
                if(percentDifference > 0){
                    element.classList.add('up')
                } else{
                    element.classList.add('down')
                }
                // Update our profit loss
                profitLossElement.textContent = percentDifference.toFixed(4)
            }

        })

       
    });
</script>