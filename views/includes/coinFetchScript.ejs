<!-- Script on client side that wait for socket emit, and then updates newest prices and works out newest % difference -->

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    socket.on('coinDataUpdated', (updatedCoinData) => {
        // Update all elements with class name 'coin-name' with data.coinName
        const coinNameElements = document.querySelectorAll('.coin-name');
        coinNameElements.forEach((element, index) => {
            element.textContent = updatedCoinData[index].name;
        });

        // Update all elements with class name 'coin-price' with data.coinPrice
        const coinPriceElements = document.querySelectorAll('.coin-price');
        coinPriceElements.forEach((element, index) => {
            element.textContent = updatedCoinData[index].price
        });

        // Find overarching coin data div
        const coinDataElements = document.querySelectorAll('.coin-data');

        coinDataElements.forEach(element => {
            const currentPrice = parseFloat(element.querySelector('.coin-price').innerText)
            const buyPriceElement = element.querySelector('.buy-price')
            const profitLossContainerElement = element.querySelector('.profit-loss-container')
            const profitLossElement = element.querySelector('.profit-loss')

            // If user has bought coin input field will be gone and buy price will be present
            if(buyPriceElement){
                const buyPrice = parseFloat(buyPriceElement.innerText)

                // Work out the % difference from when user bought to current
                const percentDifference = ((currentPrice - buyPrice) / buyPrice) * 100
                if(percentDifference > 0){
                    profitLossContainerElement.classList.add('up')
                } else{
                    profitLossContainerElement.classList.add('down')
                }
                // Update our profit loss
                profitLossElement.textContent = percentDifference.toFixed(4)
            }

        })

       
    });
</script>